# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)
 
platform :ios do

  #è¿™é‡Œæ˜¯æŒ‡ä»¤æè¿°
  desc "build develop ipa"
  lane :DEBUG do |options|
 
    # add actions here: https://docs.fastlane.tools/actions
    #automatic_code_signingå’Œgyméƒ½æ˜¯fastlaneå‘½ä»¤ å¯ä»¥æŸ¥é˜…ç›¸å…³æ–‡æ¡£
    #æŒ‡å®šç­¾åå‚æ•°
    automatic_code_signing(
    #è·¯å¾„
        path: "WebviewComponent.xcodeproj",
    #è¯ä¹¦
        code_sign_identity: "Apple Development: forliujiang@icloud.com (NYQEEV5UBU)",
        team_id: "RJ9SHE83UJ",
        use_automatic_signing: false,
    	targets: ["WebviewComponent_Example"],
        #æè¿°æ–‡ä»¶ Macä¸Šæè¿°æ–‡ä»¶è·¯å¾„ ~/Library/MobileDevice/Provisioning Profiles
        profile_name: "8a945911-1ca8-4b96-ac94-1cf4d54a1067.mobileprovision"
    )
 
    #æŒ‡å®šæ„å»ºå‚æ•°
    gym(
        #export_method: app-store, package, ad-hoc, enterprise, development, å’Œdeveloper-id
        scheme: "WebviewComponent-Example",
        workspace: "WebviewComponent.xcworkspace",
        # project: "WebviewComponent.xcodeproj",
        clean: true,
        configuration: "Release",
        export_method: "development",
        output_name: options[:ipa_name],
        output_directory: "#{options[:output_path]}",
        export_xcargs: "-allowProvisioningUpdates",
        archive_path: "#{options[:output_path]}/#{options[:ipa_name]}"
    )
    puts "*************| å¼€å§‹ä¸Šä¼ è’²å…¬è‹±... |*************"
        # å¼€å§‹ä¸Šä¼ è’²å…¬è‹±
        pgyer(api_key: "5962cf1e989d2a6d7100983a551040a6", user_key:"7d286b445a681332f8e75cf13e996234")
    puts "*************| ğŸ‰ä¸Šä¼ è’²å…¬è‹±æˆåŠŸğŸ‰ |*************"
  end
 
 lane :PRE_RELEASE do |options|
 
    
    # add actions here: https://docs.fastlane.tools/actions
    #automatic_code_signingå’Œgyméƒ½æ˜¯fastlaneå‘½ä»¤ å¯ä»¥æŸ¥é˜…ç›¸å…³æ–‡æ¡£
    #æŒ‡å®šç­¾åå‚æ•°
    automatic_code_signing(
    #è·¯å¾„
        path: "WebviewComponent.xcodeproj",
    #è¯ä¹¦
        code_sign_identity: "Apple Development: forliujiang@icloud.com (NYQEEV5UBU)",
        #æè¿°æ–‡ä»¶ Macä¸Šæè¿°æ–‡ä»¶è·¯å¾„ ~/Library/MobileDevice/Provisioning Profiles
        profile_name: "5bf8e155-9151-4a2f-ae31-49a9a051d9ca.mobileprovision"
    )
 
    #æŒ‡å®šæ„å»ºå‚æ•°
    gym(
        #export_method: app-store, package, ad-hoc, enterprise, development, å’Œdeveloper-id
        scheme: "WebviewComponent-Example",
        workspace: "WebviewComponent.xcworkspace",
        project: "WebviewComponent.xcodeproj",
        clean: true,
        configuration: "Release",
        export_method: "ad-hoc",
        output_name: options[:ipa_name],
        output_directory: "#{options[:output_path]}",
        export_xcargs: "-allowProvisioningUpdates",
        archive_path: "#{options[:output_path]}/#{options[:ipa_name]}"
    )
    puts "*************| å¼€å§‹ä¸Šä¼ è’²å…¬è‹±... |*************"
        # å¼€å§‹ä¸Šä¼ è’²å…¬è‹±
        pgyer(api_key: "5962cf1e989d2a6d7100983a551040a6", user_key:"7d286b445a681332f8e75cf13e996234")
    puts "*************| ä¸Šä¼ è’²å…¬è‹±æˆåŠŸğŸ‰ |*************"
  end
 
lane :RELEASE do |options|
 
    # add actions here: https://docs.fastlane.tools/actions
    
    puts "ä»¥app-store æ–¹å¼æ‰“åŒ…"
    
    #æŒ‡å®šæ„å»ºå‚æ•°
 
    #è‡ªåŠ¨å¢åŠ buildç‰ˆæœ¬å·
    increment_build_number
 
    gym(
        scheme: "è¦æ‰“åŒ…çš„targeté¡¹ç›®åç§°",
        workspace: "é¡¹ç›®åç§°.xcworkspace",
        clean: true,
        configuration: "Release",
        output_name: options[:ipa_name],
        output_directory: "#{options[:output_path]}",
        export_xcargs: "-allowProvisioningUpdates",
        export_options: {
                method: "app-store",
                provisioningProfiles: { 
                        # bundleidï¼Œæ‰“åŒ…ç”¨çš„è¯ä¹¦åå­—,è¿™é‡Œä¹Ÿå¯ä»¥é‡‡ç”¨å‚æ•°ä¼ é€’,çœ‹ä¸ªäººå–œå¥½å§
                        "com.you.bundleIdentifier": "your_appStore" 
                }
                
        }
    )
    deliver(
                # é€‰æ‹©è·³è¿‡å›¾ç‰‡å’Œå…ƒæ•°æ®ä¸Šä¼ ï¼Œè‡ªå·±å»é…ç½®
                skip_screenshots:true,
                skip_metadata:true,
                # ä¸Šä¼ æ‰€æœ‰ä¿¡æ¯åˆ°App Store
                force:true,
                )
    puts "*************| ä¸Šä¼ AppStoreæˆåŠŸğŸ‰ |*************"
 
  end
 
 
end